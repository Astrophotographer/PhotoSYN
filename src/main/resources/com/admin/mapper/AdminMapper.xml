<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.admin.mapper.AdminMapper">

    <resultMap type="com.member.domain.MemberDTO" id="memberMap">
        <id property="id" column="u_id"/> <!-- primary key 지정 -->
        <result property="id" column="u_id"/>
        <result property="pw" column="u_pw"/>
        <result property="phone" column="u_phone"/>
        <result property="name" column="u_nick"/>
        <result property="reg" column="u_reg"/>
        <result property="status" column="u_status"/>
        <result property="pic" column="u_pic"/>
        <result property="point" column="u_point"/>
        <result property="membership" column="ms_membership"/>
        <result property="sns" column="u_sns"/>
        <result property="snsToken" column="u_snsToken"/>
        <collection property="authDTOList" resultMap="authMap"></collection>
    </resultMap>
    <!-- 권한 테이블 값을 AuthDTO 클래스에 대입하는 것 명확히 정의 -->
    <resultMap type="com.member.domain.AuthDTO" id="authMap">
        <result property="id" column="id"/>
        <result property="auth" column="auth"/>
    </resultMap>

    <select id="getUserCount" resultType="_int">
        SELECT COUNT(*)
        FROM user_list
    </select>

    <select id="getSalesCount" resultType="_int">
        SELECT COUNT(*)
        FROM BUY
    </select>

    <select id="getRecentGalleryCount" resultType="_int">
        select count(*)
        from GALLERY
        where g_REG >= to_char(SYSDATE - 1, 'YYYYMMDD')
    </select>
    <!--    where g_REG >= to_char(SYSDATE-1,'DD-MM-YY')-->

    <select id="getRecentBlogCount" resultType="_int">
        select count(*)
        from blog
        where b_REG >= to_char(SYSDATE - 1, 'YYYYMMDD')
    </select>
    <!--    where b_REG >= to_char(SYSDATE - 1, 'DD-MM-YY')-->

    <!--    <select id="getMemberDTOList" resultType="com.member.domain.MemberDTO">-->
    <select id="getMemberDTOList" resultMap="memberMap">
        select *
        from user_list
        order by u_reg desc
    </select>

    <update id="updateMemberShip">
        update user_list
        set ms_membership = #{membership}
        where u_id = #{id}
    </update>

    <update id="updatePoint">
        update user_list
        set u_point = u_point + #{point}
        where u_id = #{id}
    </update>

    <select id="getMemeberINFO" resultType="com.admin.domain.AdminMemberDTO">
        select ul.*,
               au.auth,
               ac.A_ACCOUNT,
               ac.A_BANK,
               ac.A_HOLDER,
               sns.S_INSTAGRAM,
               sns.S_TWITTER,
               sns.S_FACEBOOK,
               sns.S_YOUTUBE,
               ui.U_INTRO
        from USER_LIST ul,
             USER_AUTH au,
             ACCOUNTLIST ac,
             SNS sns,
             USER_INTRO ui
        WHERE ul.U_ID = au.ID(+)
          and ul.U_ID = ac.U_ID(+)
          and ul.U_ID = sns.U_ID(+)
          and UL.U_ID = ui.U_ID(+)
          and UL.U_ID = #{u_id}
    </select>

    <update id="updateUserStatus">
        update user_list
        set u_status = #{status}
        where u_id = #{id}
    </update>

</mapper>